<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<title>HomeAutomation</title>
	<link rel="apple-touch-icon-precomposed" href=" http://pixabay.com/static/uploads/photo/2012/05/07/17/46/red-48810_640.png "/>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	<script src="http://benpickles.github.com/peity/jquery.peity.min.js"></script>

    <!-- User-generated js -->
    <script>
	server_addr = "http://"+location.host+"/";
	var remote = function(cmd) {
		try {
		$.getJSON(server_addr+cmd+"/?callback=?",
			function(data) {
				console.log(data);
    		})
		.error(function(data) { alert("Could not connect to HomeAutomation Server"); });
		} catch (error) {
			alert(error);
		}
	}

	function worker() {
		$.getJSON(server_addr+"Weather/?callback=?",
			function(data) {
				console.log(data);
				$('#indoor_temp').html(data.indoor_temp);
				$('#outdoor_temp').html(data.outdoor_temp);
				$('#humidity').html(data.humidity);
				$('#graph_outdoor').attr('src','https://api.cosm.com/v2/feeds/97393/datastreams/outdoor_temp.png?width=288&height=100&colour=%23f15a24&duration=1day&stroke_size=1&show_axis_labels=true&scale=datastream&min=0&max=35&timezone=UTC').animate({top:0, left:0, margin:0}, 500);
			})
		.complete(function() {
				// Schedule the next request when the current one's complete
				setTimeout(worker, 30*1000);
			});
	}

	function toggle() {
		$("select option:selected").each(function () {
	            str += $(this).text() + " ";
		  });
	}

	$.fn.peity.defaults.line = {
		colour: "#f1aa74",
		strokeColour: "#f15a24",
		strokeWidth: 1,
		delimiter: ",",
		height: 80,
		max: 100,
		min: 0,
		width: 220
	}
	function stats() {
		$.getJSON(server_addr+"system/",
			function(data) {
				console.log(data);
				var values = $('#cpuUsageLine').text().split(",");
				values.shift();
				values.push(data.cpuUsage);
				$('#cpuUsageLine').text(values.join(",")).change();
				$('#cpuUsage').text(data.cpuUsage);

				$('#memUsed').text(((data.memTotal-data.memAvailable)/1024/1024).toFixed(0));
				$('#memPie').text(data.memTotal-data.memAvailable+'/'+data.memTotal).change();

				index = 1;
				$.each(data.disk, function(key, val) {
					$('#diskUsage'+index).text((val.used/val.total * 100).toPrecision(3));
					$('#diskUsagePie'+index).text(val.used/1024/1024+'/'+val.total/1024/1024).change();
				});
			})
		.complete(function() {
			setTimeout(stats,5*1000);
		})
	}
	$(function() {
		$('#sony_source').click(function() { remote("IR/AV"); });
		$('#sony_volup').click(function() { remote("IR/volup"); });
		$('#sony_voldown').click(function() { remote("IR/voldown"); });


		$.getJSON(server_addr+'system/', function(data) {
			console.log(data)
			$('#cpuUsageLine').peity("line");
			$('#memPie').peity("pie");
			index = 1;
			$.each(data.disk, function(key, val) {
				$('#diskUsage').append('<div class="half box"><div class="label">'+key+'</div><span id="diskUsage'+index+'"></span><div class="label">%</div></div><span class="pie" id="diskUsagePie'+index+'" data-colours=\'["f15a24", "#dddddd"]\' data-diameter="70">0/100</span>')
				$('#diskUsagePie'+index).peity("pie");
				index++;
			});
			stats();
		});

		$('select').each(function() {
			$(this).change(function() {
				var cmd = "RF/"+$("input:checked").val(); //get the channel
				cmd += $.trim($("option:selected", this).parents(".ui-block-b").prev().text()); //go to the previous block label to figure which device
				cmd += "/"+$("option:selected", this).val(); // on vs off
				remote(cmd);
			});
		});
//		worker();
	});


    </script>

	<style>
		.box {
			-moz-border-radius: 15px;
			border-radius: 15px;
			background-color: #f15a24;
			color: white;
			height: 50px;
			padding: 8px 20px 8px 20px;
			margin: 16px;
			font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
			font-size: 25px;
			font-style: normal;
			font-weight: bold;
			float: left;
			text-align: center;
		}
		.graph {
			padding: 8px 20px 8px 20px;
			margin: 16px;
		}
		.half {
			width: 70px;
		}
		.full {
			width: 210px;
		}
		.label {
			font-size: 10px;
			font-style: normal;
			font-weight: normal;
		}
	</style>
</head>


<body>

<!-- Home -->
<div data-role="page" id="page1">
    <div data-theme="a" data-role="header">
        <h3 id="title">
        	Weather Station
		</h3>
		<a href="#page2" data-icon="gear" class="ui-btn-right">Server</a>
    </div>
    <div data-role="content">
		<h1> Temperature </h1>
			<div class="half box"><span id="outdoor_temp"></span>ยบ<div class="label">outdoor</div></div>
			<div class="half box"><span id="indoor_temp"></span>ยบ<div class="label">indoor</div></div>
			<div style="width: 288px; height: 100px; position: relative; background-color: #fbfbfb; border: 1px solid #b8b8b8; clear:both; margin-top: 140px; ">
	        	    <img src="http://codiqa.com/static/images/v2/image.png" alt="image" style="position: absolute; top: 50%; left: 50%; margin-left: -16px; margin-top: -18px" id="graph_outdoor">
		        </div>
		<h1 style="clear: both"> Humidity </h1>
			<div class="full box"><span id="humidity"></span><div class="label">%</div></div>
    </div>
	<div data-rote="footer" data-position="fixed">
        <div id="Remote" data-role="navbar" data-iconpos="top">
            <ul>
                <li> <a href="#sony" data-transition="fade" data-theme="" data-icon="grid"> SONY </a> </li>
                <li> <a href="#chacon" data-transition="fade" data-theme="" data-icon="home"> Chacon </a> </li>
            </ul>
        </div>
	</div>
</div>

<!-- Server -->
<div data-role="page" id="page2">
    <div data-theme="a" data-role="header">
		<a href="#" data-role="button" data-rel="back" data-icon="arrow-l">Back</a>
        <h3 id="title">
            Server Info
        </h3>
    </div>
    <div data-role="content">
		<h1> CPU Usage</h1>
			<div class="half box"><span id="cpuUsage"></span><div class="label">%</div></div><span class="line graph" id="cpuUsageLine">0</span>
		<h1 style="clear: both"> Memory Usage </h1>
			<div class="half box"><span id="memUsed"></span><div class="label">MB</div></div><span class="pie" id="memPie" data-colours='["f15a24", "#dddddd"]' data-diameter="70">0/100</span>
		<h1 style="clear: both"> Disk Usage </h1>
			<span id="diskUsage">
			</span>
    </div>
</div>


<!-- Chacon RF Remote -->
<div data-role="page" id="chacon" data-add-back-btn="true">
    <div data-theme="a" data-role="header">
		<a href="#" data-role="button" data-rel="back" data-icon="arrow-l">Back</a>
        <h3>Chacon</h3>
    </div>
    <div data-role="content">
        <div data-role="fieldcontain" style="margin-left:auto; margin-right:auto; width: 210px">
            <fieldset id="radio" data-role="controlgroup" data-type="horizontal">
                <input id="radioA" name="type" value="A" type="radio" checked>
                <label for="radioA">
                    A
                </label>
                <input id="radioB" name="type" value="B" type="radio">
                <label for="radioB">
                    B
                </label>
                <input id="radioC" name="type" value="C" type="radio">
                <label for="radioC">
                    C
                </label>
            </fieldset>
        </div>
        <div class="ui-grid-a">
            <div class="ui-block-a">
				<h2 style="text-align:right; padding-right:100px">1</h2>
            </div>
            <div class="ui-block-b">
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <select name="toggleswitch1" id="toggleswitch1" data-theme="" data-role="slider">
                            <option value="off">
                                Off
                            </option>
                            <option value="on">
                                On
                            </option>
                        </select>
                    </fieldset>
                </div>
            </div>
            <div class="ui-block-a">
				<h2 style="text-align:right; padding-right:100px">2</h2>
            </div>
            <div class="ui-block-b">
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <select name="toggleswitch2" id="toggleswitch2" data-theme="" data-role="slider">
                            <option value="off">
                                Off
                            </option>
                            <option value="on">
                                On
                            </option>
                        </select>
                    </fieldset>
                </div>
            </div>
            <div class="ui-block-a">
				<h2 style="text-align:right; padding-right:100px">3</h2>
            </div>
            <div class="ui-block-b">
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <select name="toggleswitch3" id="toggleswitch3" data-theme="" data-role="slider">
                            <option value="off">
                                Off
                            </option>
                            <option value="on">
                                On
                            </option>
                        </select>
                    </fieldset>
                </div>
            </div>
            <div class="ui-block-a">
				<h2 style="text-align:right; padding-right:100px">4</h2>
            </div>
            <div class="ui-block-b">
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <select name="toggleswitch4" id="toggleswitch4" data-theme="" data-role="slider">
                            <option value="off">
                                Off
                            </option>
                            <option value="on">
                                On
                            </option>
                        </select>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SONY -->
<div data-role="page" id="sony" data-add-back-btn="true">
    <div data-theme="a" data-role="header">
		<a href="#" data-role="button" data-rel="back" data-icon="arrow-l">Back</a>
		<h3>
            SONY
        </h3>
    </div>
    <div data-role="content">
        <div class="ui-grid-b">
            <div class="ui-block-a">
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
            </div>
            <div class="ui-block-a">
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
            </div>
            <div class="ui-block-a">
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
            </div>
            <div class="ui-block-a">
                <a id="sony_source" data-role="button" data-inline="true" href="#av" data-icon="arrow-l" data-iconpos="left"> Source </a>
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
                <a id="sony_volup" data-role="button" data-inline="true" href="#volup" data-icon="plus" data-iconpos="left"> Vol </a>
            </div>
            <div class="ui-block-a">
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
            </div>
            <div class="ui-block-a">
            </div>
            <div class="ui-block-b">
            </div>
            <div class="ui-block-c">
                <a id="sony_voldown" data-role="button" data-inline="true" href="#voldown" data-icon="minus" data-iconpos="left"> Vol </a>
            </div>
        </div>
    </div>
</div>

</body>
</html>
